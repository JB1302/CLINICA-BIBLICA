-- =====================================================
-- CREACION DE TABLAS
-- respeta dependencias de FK
-- Servidor: CLINICA_FINAL (4.156.223.214:1521/XEPDB1)
-- Usuario: CLINICA / 1234
-- =====================================================

-- 1. TABLA ESTADO_CITA (sin dependencias)
CREATE TABLE ESTADO_CITA (
    ID_ESTADO NUMBER GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
    NOMBRE_ESTADO VARCHAR2(50),
    DESCRIPCION   VARCHAR2(150)
);

-- 2. TABLA MOTIVO_CANCELACION (sin dependencias)
CREATE TABLE MOTIVO_CANCELACION (
    ID_MOTIVO_CANCELACION NUMBER GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
    NOMBRE                VARCHAR2(50),
    DESCRIPCION           VARCHAR2(150)
);

-- 3. TABLA ESPECIALIDAD (sin dependencias)
CREATE TABLE ESPECIALIDAD (
    ID_ESPECIALIDAD NUMBER GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
    NOMBRE          VARCHAR2(50)
);

-- 4. TABLA CLINICA (sin dependencias)
CREATE TABLE CLINICA (
    ID_CLINICA NUMBER GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
    NOMBRE VARCHAR2(50),
    CODIGO_CLINICA VARCHAR2(50),
    TELEFONO VARCHAR2(50)
);

-- 5. TABLA PACIENTE (sin dependencias)
CREATE TABLE PACIENTE (
    ID_PACIENTE         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    CEDULA              VARCHAR2(20),
    PRIMER_NOMBRE       VARCHAR2(50) NOT NULL,
    SEGUNDO_NOMBRE      VARCHAR2(50),
    PRIMER_APELLIDO     VARCHAR2(50) NOT NULL,
    SEGUNDO_APELLIDO    VARCHAR2(50),
    FECHA_NACIMIENTO    DATE,
    SEXO                CHAR(1) CHECK (SEXO IN ('M','F')),
    OBSERVACIONES       VARCHAR2(255),
    TELEFONO            VARCHAR2(20),
    DIRECCION           VARCHAR2(150),
    CORREO_ELECTRONICO  VARCHAR2(100)
);

-- 6. TABLA AGENDA_HORARIO (sin dependencias)
CREATE TABLE AGENDA_HORARIO (
    ID_HORARIO  NUMBER(2)
        CONSTRAINT PK_AGENDA_HORARIO PRIMARY KEY
        CONSTRAINT CHK_AH_ID_RANGO CHECK (ID_HORARIO BETWEEN 1 AND 10),
    HORARIO     VARCHAR2(60) NOT NULL,
    DIA_SEMANA  NUMBER(1) NOT NULL
        CONSTRAINT CHK_AH_DIA CHECK (DIA_SEMANA BETWEEN 1 AND 5),
    TURNO       CHAR(1) NOT NULL
        CONSTRAINT CHK_AH_TURNO CHECK (TURNO IN ('M','T')),
    HORA_INICIO CHAR(5) NOT NULL,
    HORA_FIN    CHAR(5) NOT NULL,

    CONSTRAINT UQ_AH_DIA_TURNO UNIQUE (DIA_SEMANA, TURNO),
    CONSTRAINT CHK_AH_HORARIO_VALIDO
        CHECK (
            (TURNO = 'M' AND HORA_INICIO = '07:00' AND HORA_FIN = '13:00')
            OR
            (TURNO = 'T' AND HORA_INICIO = '13:00' AND HORA_FIN = '19:00')
        )
);

-- 7. TABLA PERSONAL (depende de AGENDA_HORARIO)
CREATE TABLE PERSONAL (
    ID_PERSONAL        NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    PRIMER_NOMBRE      VARCHAR2(50) NOT NULL,
    SEGUNDO_NOMBRE     VARCHAR2(50),
    PRIMER_APELLIDO     VARCHAR2(50) NOT NULL,
    SEGUNDO_APELLIDO    VARCHAR2(50),
    PUESTO             VARCHAR2(50),
    ACTIVO             CHAR(1) CHECK (ACTIVO IN ('S','N')),
    CORREO_ELECTRONICO VARCHAR2(100),
    TELEFONO           VARCHAR2(50),
    DIRECCION          VARCHAR2(150),
    PROVINCIA          VARCHAR2(50),
    CANTON             VARCHAR2(50),
    DISTRITO           VARCHAR2(50),
    HORARIO_TRABAJO    NUMBER(2),
    CONSTRAINT FK_PERSONAL_HORARIO FOREIGN KEY (HORARIO_TRABAJO)
        REFERENCES AGENDA_HORARIO(ID_HORARIO)
);

-- 8. TABLA MEDICO (depende de PERSONAL y AGENDA_HORARIO)
CREATE TABLE MEDICO (
    ID_MEDICO      NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_PERSONAL    NUMBER NOT NULL,
    ID_HORARIO     NUMBER(2),
    CONSTRAINT FK_MEDICO_PERSONAL FOREIGN KEY (ID_PERSONAL)
        REFERENCES PERSONAL(ID_PERSONAL),
    CONSTRAINT FK_MEDICO_HORARIO FOREIGN KEY (ID_HORARIO)
        REFERENCES AGENDA_HORARIO(ID_HORARIO)
);

-- 8. TABLA MEDICO_ESPECIALIDAD (depende de MEDICO y ESPECIALIDAD)
CREATE TABLE MEDICO_ESPECIALIDAD (
    ID_MEDICO_ESPECIALIDAD NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ID_MEDICO              NUMBER NOT NULL,
    ID_ESPECIALIDAD        NUMBER NOT NULL,
    DESDE DATE, 
    HASTA DATE,
    CONSTRAINT FK_MEDESP_MEDICO FOREIGN KEY (ID_MEDICO)
        REFERENCES MEDICO(ID_MEDICO),
    CONSTRAINT FK_MEDESP_ESPECIALIDAD FOREIGN KEY (ID_ESPECIALIDAD)
        REFERENCES ESPECIALIDAD(ID_ESPECIALIDAD),
    CONSTRAINT CK_FECHAS_MEDESP CHECK (HASTA IS NULL OR HASTA >= DESDE)
);

-- 9. TABLA CONSULTORIO (depende de CLINICA)
CREATE TABLE CONSULTORIO (
    ID_CONSULTORIO   NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
    ID_CLINICA       NUMBER NOT NULL,
    NOMBRE           VARCHAR2(50),
    TIPO             VARCHAR2(50),
    CONSTRAINT FK_CONSULTORIO_CLINICA FOREIGN KEY (ID_CLINICA)
        REFERENCES CLINICA(ID_CLINICA)
);

-- 10. TABLA AGENDA_MEDICA (depende de MEDICO, CONSULTORIO y AGENDA_HORARIO)
CREATE TABLE AGENDA_MEDICA (
    ID_AGENDA         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
    ID_MEDICO         NUMBER NOT NULL,
    ID_CONSULTORIO    NUMBER NOT NULL,
    ID_HORARIO        NUMBER(2),
    VIGENTE_DESDE     DATE,
    VIGENTE_HASTA     DATE,
    CONSTRAINT FK_AGENDA_MEDICO FOREIGN KEY (ID_MEDICO)
        REFERENCES MEDICO(ID_MEDICO),
    CONSTRAINT FK_AGENDA_CONSULTORIO FOREIGN KEY (ID_CONSULTORIO)
        REFERENCES CONSULTORIO(ID_CONSULTORIO),
    CONSTRAINT FK_AGENDA_HORARIO FOREIGN KEY (ID_HORARIO)
        REFERENCES AGENDA_HORARIO(ID_HORARIO),
    CONSTRAINT CK_AGENDA_VIGENCIA CHECK (VIGENTE_HASTA IS NULL OR VIGENTE_HASTA >= VIGENTE_DESDE)
);

-- 11. TABLA CITA (depende de PACIENTE, MEDICO, CONSULTORIO, ESTADO_CITA, MOTIVO_CANCELACION, AGENDA_MEDICA)
CREATE TABLE CITA (
    ID_CITA               NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
    ID_PACIENTE           NUMBER NOT NULL,
    ID_MEDICO             NUMBER NOT NULL,
    ID_CONSULTORIO        NUMBER NOT NULL,
    ID_ESTADO             NUMBER NOT NULL,
    ID_MOTIVO_CANCELACION NUMBER,
    ID_AGENDA             NUMBER,  
    FECHA                 DATE NOT NULL,
    HORA_AGENDADA_INICIO  TIMESTAMP NOT NULL,
    HORA_AGENDADA_FIN     TIMESTAMP NOT NULL,
    OBSERVACIONES         VARCHAR2(255),

    CONSTRAINT FK_CITA_PACIENTE FOREIGN KEY (ID_PACIENTE)
        REFERENCES PACIENTE(ID_PACIENTE),

    CONSTRAINT FK_CITA_MEDICO FOREIGN KEY (ID_MEDICO)
        REFERENCES MEDICO(ID_MEDICO),

    CONSTRAINT FK_CITA_CONSULTORIO FOREIGN KEY (ID_CONSULTORIO)
        REFERENCES CONSULTORIO(ID_CONSULTORIO),

    CONSTRAINT FK_CITA_ESTADO FOREIGN KEY (ID_ESTADO)
        REFERENCES ESTADO_CITA(ID_ESTADO),

    CONSTRAINT FK_CANCELACION_CITA FOREIGN KEY (ID_MOTIVO_CANCELACION)
        REFERENCES MOTIVO_CANCELACION(ID_MOTIVO_CANCELACION),

    CONSTRAINT FK_CITA_AGENDA FOREIGN KEY (ID_AGENDA)
        REFERENCES AGENDA_MEDICA(ID_AGENDA),

    CONSTRAINT CK_HORARIO_CITA CHECK (HORA_AGENDADA_FIN > HORA_AGENDADA_INICIO)
);

-- 12. TABLA ATENCION (depende de CITA)
CREATE TABLE ATENCION (
    ID_ATENCION NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
    ID_CITA NUMBER NOT NULL,
    FECHA_INICIO DATE,
    FECHA_FIN DATE,
    MOTIVO_CONSULTA   VARCHAR2(150),
    HISTORIAL_CLINICO VARCHAR2(500),
    EXAMEN_FISICO     VARCHAR2(300),
    DIAGNOSTICO       VARCHAR2(100),
    CONSTRAINT FK_ATENCION_CITA FOREIGN KEY (ID_CITA)
        REFERENCES CITA(ID_CITA)
);

-- 13. TABLA CONTRATO (depende de PERSONAL)
CREATE TABLE CONTRATO (
    ID_CONTRATO       NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
    ID_PERSONAL       NUMBER NOT NULL,
    FECHA_REGISTRO    DATE,
    VIGENTE           CHAR(1) CHECK (VIGENTE IN ('S','N')),
    CONSTRAINT FK_CONTRATO_PERSONAL FOREIGN KEY (ID_PERSONAL)
        REFERENCES PERSONAL(ID_PERSONAL)
);

-- 14. TABLA EXPEDIENTE (depende de PACIENTE)
CREATE TABLE EXPEDIENTE (
    ID_EXPEDIENTE NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
    ID_PACIENTE   NUMBER NOT NULL,
    CREADO_EN     DATE,
    NOTAS         VARCHAR2(100),
    CONSTRAINT FK_EXPEDIENTE_PACIENTE FOREIGN KEY (ID_PACIENTE)
        REFERENCES PACIENTE(ID_PACIENTE)
);

  COMMIT;

SELECT * FROM PACIENTE;
SELECT * FROM PERSONAL;
SELECT * FROM CONSULTORIO;
SELECT * FROM CITA;
SELECT * FROM MEDICO;
SELECT * FROM CLINICA;
SELECT * FROM ESPECIALIDAD;
SELECT * FROM ESTADO_CITA;
SELECT * FROM MOTIVO_CANCELACION;
SELECT * FROM AGENDA_MEDICA;
SELECT * FROM AGENDA_HORARIO;
SELECT * FROM EXPEDIENTE;
SELECT * FROM CONTRATO;
SELECT * FROM ATENCION;


SELECT COUNT(*) as TOTAL_TABLAS_CREADAS FROM user_tables;
SELECT table_name FROM user_tables ORDER BY table_name;

